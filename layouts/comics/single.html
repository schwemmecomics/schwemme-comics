{{ define "main" }}
<article style="max-width: 900px; margin: 0 auto; text-align: center; padding: 20px; font-family: sans-serif;">
    
    <h1>{{ .Title }}</h1>

    {{/* Navigation oben */}}
    {{ partial "comic-nav.html" . }}

    {{/* Das Comic-Bild */}}
    <div class="comic-display" style="margin: 30px 0;">
        {{ $comic := .Resources.GetMatch (printf "comic.%s.*" .Lang) | default (.Resources.GetMatch "comic.*") }}
        {{ if $comic }}
            <img src="{{ $comic.RelPermalink }}" alt="{{ .Title }}" style="max-width: 100%; height: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        {{ end }}
    </div>

    {{/* Navigation unten */}}
    {{ partial "comic-nav.html" . }}

<div class="comic-content" style="max-width: 800px; margin: 15px auto; padding: 0 15px; text-align: center;">
    
    {{/* Nummer & Titel - schön dezent in 1.2em */}}
    <div class="comic-title-area" style="margin-bottom: 15px; border-top: 1px solid #eee; padding-top: 15px;">
        <h2 style="font-size: 1.2em; margin: 0; color: #444; font-weight: bold;">
            #{{ .File.ContentBaseName }} – {{ .Title }}
        </h2>
    </div>

    {{/* Hier wird automatisch der Text aus der index.md (oder index.en.md) geladen */}}
    <div class="author-notes" style="font-style: italic; color: #666; line-height: 1.6; font-size: 0.95em; text-align: left;">
        {{ .Content }}
    </div>
    
</div>
    
    {{/* Navigation unter Notizen */}}
    {{ partial "comic-nav.html" . }}
    
    {{/* Share Section*/}}
<div class="share-container" style="margin: 20px 0; text-align: center;">
    {{/* Der Button mit deinem einen Icon */}}
    <button id="shareBtn" style="background: none; border: none; cursor: pointer; padding: 10px;">
        <img src="{{ "images/share-icon.png" | relURL }}" alt="Teilen" style="width: 40px; height: auto;">
        <p style="margin: 0; font-size: 0.8em; color: #666;">Comic teilen</p>
    </button>
</div>

<script>
document.getElementById('shareBtn').addEventListener('click', async () => {
    const shareData = {
        title: '{{ .Title }}',
        text: '{{ i18n "share_text" }}',
        url: '{{ .Permalink }}'
    };

    try {
        // Prüft, ob der Browser das systemeigene Teilen unterstützt
        if (navigator.share) {
            await navigator.share(shareData);
        } else {
            // Fallback: Falls nicht (z.B. am PC), wird der Link einfach kopiert
            await navigator.clipboard.writeText('{{ .Permalink }}');
            alert('Link wurde kopiert!');
        }
    } catch (err) {
        console.log('Teilen abgebrochen oder Fehler:', err);
    }
});
</script>
    
{{/* Comments */}}
<div class="comments-wrapper" style="margin-top: 60px; padding: 20px; border-top: 2px solid #eee; text-align: left;">
    <h3 style="text-align: center;">Kommentare</h3>
    
    <div id="cusdis_thread"
      data-host="https://cusdis.com"
      data-app-id="24970c43-2814-46a1-ad48-67de2a7d85c2"
      data-page-id="{{ .File.ContentBaseName }}"
      data-page-url="{{ .Permalink }}"
      data-page-title="{{ .Title }}"
      data-theme="light"
      data-lang="{{ .Lang | default "de" }}"
      style="width: 100%; min-height: 200px;"
    ></div>

    <style>
        /* Verhindert die Scrollbar innerhalb des Cusdis-Bereichs */
        #cusdis_thread iframe {
            width: 100% !important;
            height: auto !important;
            min-height: 200px;
            overflow: hidden !important;
        }
    </style>

    <script>
      window.CUSDIS_LOCALE = {{ if eq .Lang "de" }}
      {
        "powered_by": "Kommentare betrieben mit Cusdis",
        "post_comment": "Kommentar abschicken",
        "placeholder": "Schreib etwas...",
        "email": "Email (optional)",
        "nickname": "Spitzname",
        "reply": "Antworten",
        "mod_badge": "Autor",
        "load_more": "Mehr laden"
      }
      {{ else }}
      {
        "powered_by": "Comments powered by Cusdis",
        "post_comment": "Submit",
        "placeholder": "Write something...",
        "email": "Email (optional)",
        "nickname": "Nickname",
        "reply": "Reply",
        "mod_badge": "Author",
        "load_more": "Load more"
      }
      {{ end }};

      // Automatisches Resize-Skript für den Iframe
      window.addEventListener('message', e => {
        if (e.data.type === 'cusdis:height') {
          const iframe = document.querySelector('#cusdis_thread iframe');
          if (iframe) {
            iframe.style.height = e.data.data + 'px';
          }
        }
      });
    </script>
    
    {{/* Das Cusdis-Skript */}}
    <script async defer src="{{ "js/cusdis.js" | relURL }}"></script>
</div>


    
</article>
{{ end }}
